<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Device</title>
    <script src="/socket.io/socket.io.js"></script>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/normalize/8.0.1/normalize.min.css"
      integrity="sha512-NhSC1YmyruXifcj/KFRWoC561YpHpc5Jtzgvbuzx5VozKpWvQ+4nXhPdFgmx8xqexRcpAglTj9sIBWINXa8x5w=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    />
  </head>
  <body>
    you are logged in, congrat
    <pre id="debug"></pre>
    <button id="idle">Idle</button>
    <button id="sleep">eepy time</button>
    <script>
      const $debug = document.getElementById("debug");
      const $idle = document.getElementById("idle");
      const $sleep = document.getElementById("sleep");

      const debug = {};
      function print() {
        $debug.textContent = JSON.stringify(debug, null, 2);
      }

      const socket = io("/dachi");
      socket.on("connect", handleConnect);
      socket.on("disconnect", handleDisconnect);
      socket.on("dachi_update", handleDachiUpdate);
      socket.on("_", handleDachiUpdate);

      function handleConnect() {
        debug.connected = true;
        $idle.addEventListener("click", actions.idle);
        $sleep.addEventListener("click", actions.sleep);
        print();
      }

      function handleDisconnect() {
        debug.connected = false;
        $idle.removeEventListener("click", actions.idle);
        $sleep.removeEventListener("click", actions.sleep);
        print();
      }

      function handleDachiUpdate(dachi) {
        console.log(typeof dachi, dachi);
        debug.dachi = {
          ...debug.dachi,
          ...dachi,
        };
        print();
      }

      // const read = {
      //   dachi: () => {
      //     socket.emit("read", { type: "dachi" }, (dachi) => {
      //       debug.dachi = dachi;
      //     });
      //   },
      //   shop: () => {
      //     socket.emit("read", { type: "shop" }, (shop) => {
      //       debug.shop = shop;
      //     });
      //   },
      // };

      const actions = {
        idle: () => {
          socket.emit("action", { type: "idle" });
        },
        sleep: () => {
          socket.emit("action", { type: "sleep" });
        },
        buy: (itemId) => {
          socket.emit("action", { type: "buy", itemId });
        },
        // consume: (itemId) => {
        //   socket.emit("action", { type: "consume", itemId  });
        // },
        move: (direction) => {
          socket.emit("action", { type: "move", direction });
        },
        emote: (emoteId) => {
          socket.emit("action", { type: "emote", emoteId });
        },
        watch: () => {
          socket.emit("action", { type: "watch" });
        },
        fishing: () => {
          socket.emit("action", { type: "fishing" });
        },
        mining: () => {
          socket.emit("action", { type: "mining" });
        },
      };
    </script>
  </body>
</html>
